# KantanPro (KTPWP)

WordPressで動作する業務管理・受注進捗・請求・顧客・サービス・協力会社・レポート・スタッフチャットまで一元管理できる多機能プラグイン。

---

## 説明
KantanProは、WordPress上で以下の業務を一元管理できる多機能プラグインです。

**主要機能：**
- **6つの管理タブ**（仕事リスト・伝票処理・得意先・サービス・協力会社・レポート）
- **受注案件の進捗管理**（7段階：受注→進行中→完了→請求→支払い→ボツ→見積中）
- **受注書・請求書の作成・編集・PDF保存**（個別・一括出力対応）
- **顧客・サービス・協力会社のマスター管理**（検索・ソート・ページネーション）
- **スタッフチャット**（自動スクロール・削除連動・AJAX送信・キーボードショートカット）
- **モバイル対応UI**（gap→margin対応、iOS/Android実機対応）
- **部署管理機能**（顧客ごとの部署・担当者管理）
- **利用規約管理機能**（同意ダイアログ・管理画面・バージョン管理）
- **シンプル更新システム**（WordPress標準の更新システムに最適化）
- **セキュリティ機能**（XSS/CSRF/SQLi/権限管理/ファイル検証/ノンス/prepare文）
- **セッション管理最適化**（REST API・AJAX・内部リクエスト対応）
- **ページネーション機能**（全タブ・ポップアップ対応・一般設定連携）
- **ファイル添付機能**（ドラッグ&ドロップ・複数ファイル・自動クリーンアップ）
- **完了日自動設定機能**（進捗変更時の自動処理）
- **納期警告機能**（期限管理・アラート表示）
- **商品管理機能**（価格・数量・単位管理・データマイグレーション対応）
- **スタッフアバター表示機能**（ログイン中スタッフの可視化）
- **プラグインリファレンス機能**（包括的なヘルプシステム）

---

## 主な機能
- **6つの管理タブ**（仕事リスト・伝票処理・得意先・サービス・協力会社・レポート）
- **受注案件の進捗管理**（7段階：受注→進行中→完了→請求→支払い→ボツ→見積中）
- **受注書・請求書の作成・編集・PDF保存**（個別・一括出力対応）
- **顧客・サービス・協力会社のマスター管理**（検索・ソート・ページネーション）
- **スタッフチャット**（自動スクロール・削除連動・AJAX送信・キーボードショートカット）
- **商品・サービスの詳細管理**（カテゴリー・価格・数量・単位管理・データマイグレーション）
- **モバイルUI・レスポンシブデザイン**（iOS/Android実機対応）
- **ヘルプ（リファレンス）機能**（使用方法の詳細解説・包括的なガイド）
- **データ検索・ソート・ページネーション**（大量データの効率的管理）
- **進捗・納期管理・警告マーク**（期限管理・アラート機能）
- **権限管理・安全なDBアクセス**（ロールベースアクセス制御）
- **部署管理機能**（顧客ごとの部署・担当者管理）
- **利用規約管理機能**（同意ダイアログ・管理画面・ログイン条件）
- **シンプル更新システム**（WordPress標準の更新システムに最適化）
- **セッション管理最適化**（REST API・AJAX・内部リクエスト対応）
- **ファイル添付機能**（ドラッグ&ドロップ・複数ファイル対応）
- **完了日自動設定機能**（進捗変更時の自動処理）
- **スタッフアバター表示機能**（ログイン中スタッフの可視化）

---

## セキュリティ対策
- **SQLインジェクション防止**（prepare文・バインド変数）
- **XSS・CSRF対策**（サニタイズ・エスケープ・ノンス）
- **ファイルアップロード検証**（MIME型・サイズ制限）
- **権限管理・安全なDBアクセス**（ロールベースアクセス制御）
- **ノンス・トークンによるフォーム保護**（CSRF攻撃防止）
- **REST API制限**（ログインユーザーのみアクセス可能）
- **セッション管理最適化**（内部リクエスト・API呼び出し時の自動クローズ）
- **gap→margin対応によるUI崩れ防止**（iOS/Android実機対応）

---

## システム要件
* WordPress 5.0 以上（推奨：最新版）
* PHP 7.4 以上（推奨：PHP 8.0以上）
* MySQL 5.6 以上 または MariaDB 10.0 以上
* 推奨メモリ: 256MB 以上
* 推奨PHP拡張: GD（画像処理用）

---

## インストール
1. プラグインを `/wp-content/plugins/` にアップロード、または管理画面からインストール
2. プラグインを有効化（自動マイグレーションが実行されます）
3. 固定ページに `[ktpwp_all_tab]` を挿入
4. 管理画面「KantanPro」から基本設定を行ってください

---

## 基本的な使い方
1. **固定ページに `[ktpwp_all_tab]` を挿入**すると、6つのタブが表示されます
2. **各タブで顧客・サービス・協力会社・受注書・レポート等を管理**
3. **伝票編集時は「サービス選択」ポップアップから商品を追加**
4. **受注書・請求書はPDFで出力可能**（個別・一括対応）
5. **モバイルでも快適に操作可能**（レスポンシブデザイン）
6. **スタッフチャットでリアルタイムコミュニケーション**（Ctrl+Enter送信対応）
7. **ヘルプボタンで使用方法を確認**
8. **顧客管理で部署・担当者を管理**
9. **利用規約に同意してから利用開始**
10. **ファイル添付でメール送信も可能**

---

## 管理タブの詳細

### 1. 仕事リストタブ
- 受注案件の一覧表示・検索・フィルタリング機能
- 進捗状況による絞り込み
- 顧客名・案件名での検索
- 納期・金額でのソート
- ページネーション機能
- 納期警告マーク表示
- 完了日自動設定

### 2. 伝票処理タブ
- 受注書・請求書の作成・編集・PDF出力
- サービス選択ポップアップで商品追加（ページネーション対応）
- 個別・一括PDF出力
- メール送信機能（ファイル添付対応）
- 進捗状況の更新
- スタッフチャット機能（自動スクロール・AJAX送信）

### 3. 得意先タブ
- 顧客情報の管理・部署・担当者管理
- 顧客情報の登録・編集・削除
- 部署・担当者の追加・管理
- 選択された部署の情報を請求書に反映
- 顧客ごとのメールアドレス管理
- ページネーション対応

### 4. サービスタブ
- 商品・サービスのマスター管理
- 商品・サービスの登録・編集・削除
- カテゴリー・価格・数量・単位管理
- 検索・ソート・ページネーション
- 小数点対応の価格設定

### 5. 協力会社タブ
- 協力会社・仕入先の管理
- 協力会社情報の登録・編集・削除
- 商品・サービス管理（価格・数量・単位）
- 支払い条件の管理
- 連絡先情報の管理
- ページネーション対応

### 6. レポートタブ
- 売上・進捗のレポート表示
- 月別売上レポート
- 進捗状況の統計
- グラフ表示機能

---

## 部署管理機能
- 顧客ごとに複数の部署・担当者を管理
- 部署ごとのメールアドレス管理
- 選択された部署の情報を請求書に反映
- 部署の追加・編集・削除機能
- AJAX対応のリアルタイム更新

---

## 利用規約管理機能
- 利用規約の同意ダイアログ表示（ログイン済みユーザーのみ）
- 管理画面での利用規約編集
- 利用規約バージョン管理
- 同意状態の追跡
- ショートコード設置ページでのみ表示

---

## シンプル更新システム
- シンプルなバージョン管理
- WordPress標準の更新システムに完全対応
- 軽量で安定性を重視した設計
- 自動マイグレーション機能搭載

---

## ページネーション機能
- 全タブでの統一されたページネーション
- サービス選択ポップアップ対応
- 一般設定による表示件数制御
- レスポンシブデザイン対応

---

## ファイル添付機能
- ドラッグ&ドロップによるファイル添付
- 複数ファイル同時添付（最大50MB）
- 対応形式：PDF、画像、Office文書、圧縮ファイル
- 自動クリーンアップ機能
- リアルタイムプレビュー

---

## 完了日自動設定機能
- 進捗ステータス変更時の自動処理
- 完了時の自動日付設定
- 受注以前への変更時の自動クリア
- 仕事リスト・受注書詳細両対応

---

## 納期警告機能
- 期限間近の案件への警告マーク表示
- リアルタイム更新対応
- ツールチップでの残り日数表示

---

## 商品管理機能
- 商品名・単価・数量・単位の管理
- DECIMAL型による精密な価格計算
- デフォルト値設定（数量：1、単位：式）
- インデックス最適化によるパフォーマンス向上
- データマイグレーション機能（職能→商品管理への移行）

---

## スタッフアバター表示機能
- ログイン中スタッフのアバター一覧表示
- 現在のユーザーを強調表示
- レスポンシブデザイン対応
- ツールチップでユーザー名表示
- セッション管理との連携

---

## プラグインリファレンス機能
- 包括的なヘルプシステム
- 機能別詳細ガイド
- トラブルシューティング情報
- キャッシュ機能付きの高速表示
- モーダルベースの使いやすいUI

---

## 変更履歴

### 1.0.7(preview)
- 決済設定機能の削除（ktpdoneプラグインに分離）
- プラグイン構造の最適化とセキュリティ向上
- エラーハンドリングの改善
- パフォーマンス最適化
- データベース構造の安定化

### 1.0.6(preview)
- 管理画面でのプラグイン情報表示の最適化
- プラグインリファレンス機能の強化
- セキュリティ機能のさらなる改善
- パフォーマンス最適化とUI/UX改善
- エラーハンドリングの強化
- データベース構造の最適化

### 1.0.5(preview)
- 商品管理システムの大幅改善（職能管理から商品管理への移行）
- データマイグレーション機能の追加（既存データの安全な移行）
- プラグインリファレンス（ヘルプ）システムの強化
- データベース構造の最適化とパフォーマンス向上
- 管理画面UIの改善とユーザビリティ向上
- セキュリティ機能のさらなる強化
- キャッシュシステムの実装
- エラーハンドリングの改善

### 1.0.4(preview)
- スタッフアバター表示機能の追加
- 完了日自動設定機能の実装（進捗変更時の自動処理）
- 納期警告機能の実装（期限管理・アラート表示）
- 商品管理機能の大幅改善（DECIMAL型・インデックス最適化）
- ページネーション機能の全面実装（サービス選択ポップアップ対応）
- ファイル添付機能の追加（ドラッグ&ドロップ・複数ファイル対応）
- スタッフチャット機能の強化（自動スクロール・AJAX送信・キーボードショートカット）
- レスポンシブデザインの改善（モバイル対応強化）
- セキュリティ機能の追加強化
- パフォーマンス最適化とUI/UX改善

### 1.0.3(preview)
- シンプルな更新システムを実装
- WordPress標準の更新システムに完全対応
- 軽量化を実現し大幅なパフォーマンス向上
- 不要なライブラリを削除（約90%のサイズ削減）
- 安定性とパフォーマンスの大幅向上
- 保守性の高いアーキテクチャを実現

### 1.0.2(preview)
- GitHub更新通知機能の修復・強化
- 管理画面更新チェックツールの追加（ツール > KantanPro更新チェック）
- プラグインリストでの更新通知表示機能
- GitHubリポジトリURLの修正（https://github.com/KantanPro/freeKTP）
- デバッグツールの追加・強化（GitHub API連携状況確認）
- プラグイン更新キャッシュクリア機能
- 手動更新チェック機能（ワンクリック確認）
- 更新通知バナーの改善（管理画面表示）

### 1.0.1(preview)
- 最新プレビュー版リリース
- ページネーション機能の全面実装（全タブ・ポップアップ対応）
- ファイル添付機能追加（ドラッグ&ドロップ・複数ファイル対応）
- 完了日自動設定機能実装（進捗変更時の自動処理）
- 納期警告機能実装（期限管理・アラート表示）
- 商品管理機能改善（価格・数量・単位管理強化）
- スタッフチャット機能強化（AJAX送信・自動スクロール・キーボードショートカット）
- レスポンシブデザイン改善（モバイル対応強化）
- セキュリティ機能の追加強化
- パフォーマンス最適化

### 1.0.0(preview)
- プレビュー版リリース
- 6つの管理タブ（仕事リスト・伝票処理・得意先・サービス・協力会社・レポート）
- 受注案件の進捗管理（7段階）
- 受注書・請求書のPDF出力機能
- 顧客・サービス・協力会社のマスター管理
- スタッフチャット機能
- モバイル対応UI（レスポンシブデザイン）
- 部署管理機能
- 利用規約管理機能
- 自動更新機能（GitHub連携）
- 動的更新履歴システム
- セキュリティ機能の強化
- セッション管理最適化

---

## バージョン
1.0.6(preview)

---

## ライセンス
GPL v2 or later  
License URI: https://www.gnu.org/licenses/gpl-2.0.html

---

## サポート
プラグインに関するお問い合わせやサポートは、以下までご連絡ください：

**公式サイト**: https://www.kantanpro.com/